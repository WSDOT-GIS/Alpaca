<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">


	<title></title>
	<link rel="stylesheet" href="http://js.arcgis.com/3.6compact/js/esri/css/esri.css">
	<style>
	 #map {
		 height: 35%;
		 width: 100%;
	 }
	 #data {
		 height: 65%;
		 width: 100%;
	 }
	</style>
</head>
<body>
	<div id="map"></div>
	<div id="data">

	</div>
	<script>
		(function () {
			"use strict";
			var url, re = /\/[^\/]+$/;

			url = re.test(location.href) ? location.href.replace(re, "/") : location.href;

			var dojoConfig = {
				async: true,
				parseOnLoad: true,
				paths: {
					"title6": url + "Scripts/wsdot/title6"
				}
			};

			window.dojoConfig = dojoConfig;
		}());
	</script>
	<script src="http://js.arcgis.com/3.6compact/"></script>
	<script>
		/*global require*/
		/*jslint browser:true*/
		require(["esri/map", "title6/languageData", "title6/raceData"], function (Map, LanguageData, RaceData) {
			"use strict";
			var map, qsParameters;

			/** Converts the query string parameters into an object.
			 * @returns {Object}
			 */
			function getQSParameters() {
				var re = /(\w+)=([^&]+)/g, match, output = {};
				match = re.exec(location.search);
				while (match) {
					output[match[1]] = JSON.parse(decodeURIComponent(match[2]));
					match = re.exec(location.search);
				}
				return output;
			}

			qsParameters = getQSParameters();

			// Convert language and race data into specialized objects.
			if (qsParameters.chartdata) {
				if (qsParameters.chartdata.language) {
					qsParameters.chartdata.language = new LanguageData(qsParameters.chartdata.language);
				}
				if (qsParameters.chartdata.race) {
					qsParameters.chartdata.race = new RaceData(qsParameters.chartdata.race);
				}
			}

			map = new Map("map", {
				basemap: "gray",
				center: qsParameters.center || null,
				scale: qsParameters.scale || null
			});

			document.getElementById("data").appendChild(qsParameters.chartdata.language.toHtmlTable());
		});
	</script>
</body>
</html>
